<!DOCTYPE html>
<html lang="en" class="h-full bg-slate-900 text-slate-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperSlide</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.0/dist/cdn.min.js"></script>
    
    <!-- Code Highlight -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <%- localStyle %>

    <!-- Mermaid -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false, theme: 'dark' });
        window.mermaid = mermaid;
    </script>

    <style>
        :root {
            --hs-accent: #3b82f6;
            --hs-bg: #0f172a;
            --hs-ui-fg: #94a3b8;
            --hs-sidebar-bg: rgba(15, 23, 42, 0.8);
        }

        /* Custom Table & Callouts */
        table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        th, td { border: 1px solid #475569; padding: 0.5em; text-align: left; }
        th { background-color: rgba(30, 41, 59, 0.5); }
        
        .callout { border-left-width: 4px; border-radius: 0.5rem; padding: 1rem; margin: 1rem 0; background-color: rgba(30, 41, 59, 0.5); }
        .callout-info { border-color: #3b82f6; }
        .callout-warning { border-color: #eab308; }
        .callout-error { border-color: #ef4444; }
        .callout-success { border-color: #22c55e; }

        /* Minimalist Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            height: 100%;
            width: 300px;
            background: var(--hs-sidebar-bg);
            backdrop-filter: blur(16px);
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 100;
        }
        .sidebar.open { transform: translateX(0); }
        
        /* Auto-hide UI components */
        .ui-element {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .ui-hidden { opacity: 0; visibility: hidden; }
    </style>

    <!-- Alpine Store -->
    <script src="/_internal/slideshow.js"></script>
</head>
<body x-data="slideshow" 
      @mousemove.window="userActive()"
      @keydown.window="userActive()"
      @keydown.right.window="next()" 
      @keydown.left.window="prev()"
      @keydown.?.window="showHelp = !showHelp"
      @keydown.escape.window="showHelp = false"
      style="display: block;"
      x-init="total = <%= slideCount %>"
      class="h-full overflow-hidden antialiased bg-[var(--hs-bg)] relative">

    <!-- Main Stage -->
    <main id="slide-container" 
          class="w-full h-full relative overflow-hidden"
          hx-get="/slides" 
          hx-trigger="load, slides-changed" 
          hx-swap="innerHTML">
          <div class="flex items-center justify-center h-full text-2xl text-slate-500 animate-pulse">Loading...</div>
    </main>

    <!-- Progress (Minimalist) -->
    <div class="fixed bottom-0 left-0 w-full h-0.5 bg-white/5 ui-element" :class="isIdle && 'ui-hidden'">
        <div class="h-full bg-[var(--hs-accent)] transition-all duration-500 ease-out shadow-[0_0_8px_var(--hs-accent)]"
             :style="'width: ' + ((current + 1) / total * 100) + '%'"></div>
    </div>

    <!-- Minimalist Sidebar Shortcuts -->
    <div class="sidebar" :class="showHelp && 'open'">
        <div class="p-8 h-full flex flex-col">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-xs font-bold uppercase tracking-[0.2em] text-[var(--hs-ui-fg)]">Key Bindings</h2>
                <button @click="showHelp = false" class="text-[var(--hs-ui-fg)] hover:text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="space-y-6">
                <div class="flex justify-between items-end border-b border-white/5 pb-2">
                    <span class="text-sm text-white/50">Next Slide</span>
                    <kbd class="text-[var(--hs-accent)] font-mono">→</kbd>
                </div>
                <div class="flex justify-between items-end border-b border-white/5 pb-2">
                    <span class="text-sm text-white/50">Prev Slide</span>
                    <kbd class="text-[var(--hs-accent)] font-mono">←</kbd>
                </div>
                <div class="flex justify-between items-end border-b border-white/5 pb-2">
                    <span class="text-sm text-white/50">Shortcuts</span>
                    <kbd class="text-[var(--hs-accent)] font-mono">?</kbd>
                </div>
                <div class="flex justify-between items-end border-b border-white/5 pb-2">
                    <span class="text-sm text-white/50">Speaker View</span>
                    <span class="text-[10px] text-[var(--hs-accent)] opacity-70 uppercase">/speaker</span>
                </div>
            </div>

            <div class="mt-auto text-[10px] text-center text-white/20 tracking-widest uppercase">
                HyperSlide Refined
            </div>
        </div>
    </div>

    <!-- Hover Hint (Bottom Right) -->
    <div class="fixed bottom-4 right-4 flex items-center gap-4 ui-element" :class="isIdle && 'ui-hidden'">
        <div class="text-[var(--hs-ui-fg)] text-[10px] font-mono tracking-tighter opacity-70">
            <span x-text="(current + 1)"></span> / <span x-text="total"></span>
        </div>
        <button @click="showHelp = true" class="w-6 h-6 rounded-full border border-white/10 flex items-center justify-center text-[10px] text-[var(--hs-ui-fg)] hover:bg-white/5 transition-colors">
            ?
        </button>
    </div>

</body>
</html>
